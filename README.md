# tibia-api
express api that serves data gathered from [tibia-scraper](https://github.com/rafaellvs/tibia-scraper)

deployed at https://tibia-db.herokuapp.com/

## stack
- node
- postgres
- sequelize
- axios
- cheerio
- eslint
- pluralize


### overview
express api implementation that serves data gathered from [tibia-scraper](https://github.com/rafaellvs/tibia-scraper/blob/master/README.md)

i used `file-generator` script to generate the database model and express routes files (models generator is the same as tibia-scraper's)
`scraper` is used to scrape attributes from each entity on TibiaWiki pages.

db is currently populated with basic info for [Creatures](https://tibia.fandom.com/wiki/List_of_Creatures), [Bosses](https://tibia.fandom.com/wiki/Bosses), [Swords](https://tibia.fandom.com/wiki/Sword_Weapons), [Axes](https://tibia.fandom.com/wiki/Axe_Weapons), [Clubs](https://tibia.fandom.com/wiki/Club_Weapons), [Distance Weapons](https://tibia.fandom.com/wiki/Distance_Weapons), [Ammunitions](https://tibia.fandom.com/wiki/Ammunition), [Rods](https://tibia.fandom.com/wiki/Rods), [Wands](https://tibia.fandom.com/wiki/Wands), [Helmets](https://tibia.fandom.com/wiki/Wands), [Armors](https://tibia.fandom.com/wiki/Armors), [Shields](https://tibia.fandom.com/wiki/Shields), [Spellbooks](https://tibia.fandom.com/wiki/Spellbooks), [Legs](https://tibia.fandom.com/wiki/Legs), [Boots](https://tibia.fandom.com/wiki/Boots), [Amulets and Necklaces](https://tibia.fandom.com/wiki/Amulets_and_Necklaces), [Rings](https://tibia.fandom.com/wiki/Rings) and [Light Sources](https://tibia.fandom.com/wiki/Light_Sources).



### run locally
setup and populate the postgres database by following the steps in "run locally" tibia-scraper's readme section

run `yarn`

start it by running `yarn start`


### structure

#### entities
manually coded array of objects in the following structure:
```
{
  name: 'Entity_name',
  url: 'Entity_url',
}
```
`name` is used essentially for model files generator and `url` with `axios` requests for `scraper`.



#### file-generator
uses [node's filesystem library](https://nodejs.org/api/fs.html) `fs`.

creates `src/models` and `src/routes` folders (if they dont exist) then proceeds to create files based on `entities` entries.

`code-templates` contains the code skeletons as template strings, on top of which the model files will be generated.

to generate files, use `yarn generate:models` and/or `yarn generate:routes` commands.



#### helpers
`utils.js` file has one function that formats attributes gathered from Wiki's pages.



#### models
generated by `file-generator`. Makes the connection to postgres database and contains the table models using Sequelize.

#### routes
generated by `file-generator`. Creates the api routes. Currently only respond to GET requests, that return all instances of requested entity.



#### scraper
uses [axios](https://github.com/axios/axios) to request pages and [cheerio](https://cheerio.js.org/) to scrape through them.

`scrape-attributes` gets the thead of Wiki's content tables. Its used to create models columns and to build each item that gets inserted into the database.
